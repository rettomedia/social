{% load static %}

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>{% block title %}{% endblock %} | Retto</title>

    <link rel="stylesheet" href="{% static 'styles/themify-icons.css' %}">
    <link rel="stylesheet" href="{% static 'styles/feather.css' %}">
    <link rel="stylesheet" href="{% static 'styles/style.css' %}">
    <link rel="stylesheet" href="{% static 'styles/lightbox.css' %}">
    <link rel="stylesheet" href="{% static 'styles/emoji.css' %}">

    <link rel="icon" type="image/png" sizes="16x16" href="{% static 'images/main-logo.png' %}">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">

    <style>
        .badge-danger {
            background-color: #dc3545 !important;
            border-color: #dc3545 !important;
        }

        .btn-danger {
            background-color: #dc3545 !important;
            border-color: #dc3545 !important;
        }

        .btn-primary {
            background-color: #2c3b8d !important;
            border-color: #2c3b8d !important;
        }
    </style>

    {% block styles %}
    {% endblock %}
</head>

<body class="color-theme-blue mont-font">
    {% block content %}
    {% endblock %}


    <script src="{% static 'js/plugin.js' %}"></script>
    <script src="{% static 'js/lightbox.js' %}"></script>
    <script src="{% static 'js/scripts.js' %}"></script>
    {% block scripts %}
    {% endblock %}
    <script>
    // Like Event
        document.addEventListener('DOMContentLoaded', function () {
            var likeButtons = document.querySelectorAll('.like-button-main');

            likeButtons.forEach(function (button) {
                button.addEventListener('click', function () {
                    var postSlug = this.getAttribute('data-post-slug');
                    var xhr = new XMLHttpRequest();

                    xhr.open('POST', '/posts/like-post/' + postSlug + '/');
                    xhr.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded');

                    xhr.onload = function () {
                        if (xhr.status == 200) {
                            var response = JSON.parse(xhr.responseText);
                            var likesCountElement = document.getElementById('likes-count-' + postSlug);

                            if (response.message === "Post liked successfully.") {
                                likesCountElement.textContent = response.likes_count;
                                button.classList.add('liked'); // Beğenildiğini göstermek için sınıf ekleyelim
                            } else if (response.message === "Post unliked successfully.") {
                                likesCountElement.textContent = response.likes_count;
                                button.classList.remove('liked'); // Beğeni kaldırıldığında sınıfı kaldıralım
                            }
                        } else {
                            console.error(xhr.responseText);
                        }
                    };

                    xhr.send();
                });
            });
        });

    </script>
</body>

</html>